<?xml version="1.0" encoding="UTF-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:include filename="$(find sushi_bot_description)/urdf/common.xacro" />

  <!-- ※ *がついたパラメータはブロックパラメータ -->

  <xacro:macro name="stanford_robot" params="prefix parent *origin">

    <joint name="${prefix}base_joint" type="fixed">
      <!-- ブロック *origin を挿入 -->
      <xacro:insert_block name="origin" />
      <parent link="${parent}" />
      <child link="${prefix}base_link" />
    </joint>

    <link name="${prefix}base_link">
      <xacro:default_inertial />
      <visual>
        <origin xyz="0 0 0.005" rpy="0 0 0" />
        <geometry>
          <box size="0.15 0.15 0.01" />
        </geometry>
        <material name="StoglRobotics/Violet" />
      </visual>
      <collision>
        <origin xyz="0 0 0.005" rpy="0 0 0" />
        <geometry>
          <box size="0.15 0.15 0.01" />
        </geometry>
      </collision>
    </link>
    <gazebo reference="${prefix}base_link">
      <material>Gazebo/Orange</material>
    </gazebo>

    <joint name="${prefix}joint_1" type="revolute">
      <parent link="${prefix}base_link" />
      <child link="${prefix}link_0" />
      <origin xyz="0 0 0.01" rpy="0 0 0" />
      <axis xyz="0 0 1" />
      <limit effort="1000" velocity="${radians(180)}" lower="-3.1416" upper="3.1416" />
    </joint>

    <link name="${prefix}link_0">
      <xacro:default_inertial />
      <visual>
        <origin xyz="0 0 0.15" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.025" length="0.30" />
        </geometry>
        <material name="Blue" />
      </visual>
      <collision>
        <origin xyz="0 0 0.15" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.025" length="0.30" />
        </geometry>
      </collision>
    </link>
    <gazebo reference="${prefix}link_0">
      <material>Gazebo/Orange</material>
    </gazebo>

    <!-- Joint 2: Revolute about Y, between link_0 and link_1 -->
    <joint name="${prefix}joint_2" type="revolute">
      <parent link="${prefix}link_0" />
      <child link="${prefix}link_1" />
      <origin xyz="0 0.05 0.275" rpy="0 ${radians(60)} 0" />
      <axis xyz="0 1 0" />
      <limit effort="1000" velocity="${radians(180)}" lower="-3.1416" upper="3.1416" />
    </joint>

    <!-- Link 1 -->
    <link name="${prefix}link_1">
      <xacro:default_inertial />
      <visual>
        <origin xyz="0 0 0.0" rpy="0 0 0" />
        <geometry>
          <box size="0.05 0.05 0.10" />
        </geometry>
        <material name="Green" />
      </visual>
      <collision>
        <origin xyz="0 0.05 0.0" rpy="0 0 0" />
        <geometry>
          <box size="0.05 0.05 0.10" />
        </geometry>
      </collision>
    </link>
    <gazebo reference="${prefix}link_1">
      <material>Gazebo/Blue</material>
    </gazebo>

    <!-- Joint 3: 直動リンク: Prismatic -->
    <joint name="${prefix}joint_3" type="prismatic">
      <parent link="${prefix}link_1" />
      <child link="${prefix}link_2" />
      <origin xyz="0 0 0.0" rpy="0 0 0" />
      <axis xyz="0 0 1" />
      <limit effort="1000.0" velocity="0.3" lower="-0.2" upper="0.2" />
    </joint>

    <!-- Link 2 -->
    <link name="${prefix}link_2">
      <xacro:default_inertial />
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <box size="0.03 0.03 0.50" />
        </geometry>
        <material name="Red" />
      </visual>
      <collision>
        <origin xyz="0 0 0.0" rpy="0 0 0" />
        <geometry>
          <box size="0.03 0.03 0.50" />
        </geometry>
      </collision>
    </link>
    <gazebo reference="${prefix}link_2">
      <material>Gazebo/Yellow</material>
    </gazebo>

    <!-- Joint 4: Revolute about Z, between link_2 and link_3 -->
    <joint name="${prefix}joint_4" type="revolute">
      <parent link="${prefix}link_2" />
      <child link="${prefix}link_3" />
      <origin xyz="0 0 0.25" rpy="0 0 0" />
      <axis xyz="0 0 1" />
      <limit effort="1000" velocity="${radians(180)}" lower="-3.1416" upper="3.1416" />
    </joint>

    <!-- Link 3 -->
    <link name="${prefix}link_3">
      <xacro:default_inertial />
      <visual>
        <origin xyz="0 0 0.02" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.025" length="0.04" />
        </geometry>
        <material name="Gray" />
      </visual>
      <collision>
        <origin xyz="0 0 0.02" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.025" length="0.04" />
        </geometry>
      </collision>
    </link>
    <gazebo reference="${prefix}link_3">
      <material>Gazebo/Green</material>
    </gazebo>

    <!-- Joint 5: Revolute about Y, between link_3 and link_4 -->
    <joint name="${prefix}joint_5" type="revolute">
      <parent link="${prefix}link_3" />
      <child link="${prefix}link_4" />
      <origin xyz="0 0 0.04" rpy="0 ${radians(90)} 0" />
      <axis xyz="0 1 0" />
      <limit effort="1000" velocity="${radians(180)}" lower="-3.1416" upper="3.1416" />
    </joint>

    <!-- Link 4 -->
    <link name="${prefix}link_4">
      <xacro:default_inertial />
      <visual>
        <origin xyz="0 0 0.02" rpy="0 0 0" />
        <geometry>
          <box size="0.03 0.02 0.04" />
        </geometry>
        <material name="White" />
      </visual>
      <collision>
        <origin xyz="0 0 0.02" rpy="0 0 0" />
        <geometry>
          <box size="0.03 0.02 0.04" />
        </geometry>
      </collision>
    </link>
    <gazebo reference="${prefix}link_4">
      <material>Gazebo/Red</material>
    </gazebo>

    <!-- Joint 6: Revolute (wrist), between link_4 and flange -->
    <joint name="${prefix}joint_6" type="revolute">
      <parent link="${prefix}link_4" />
      <child link="${prefix}link_5" />
      <origin xyz="0 0 0.04" rpy="0 0 0" />
      <axis xyz="0 0 1" />
      <limit effort="30.0" velocity="${radians(180)}" lower="-3.1416" upper="3.1416" />
    </joint>

    <!-- Flange Link (Link 5) -->
    <link name="${prefix}link_5">
      <xacro:default_inertial />
      <visual>
        <origin xyz="0 0 0.005" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.025" length="0.01" />
        </geometry>
        <material name="Black" />
      </visual>
      <collision>
        <origin xyz="0 0 0.005" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.025" length="0.01" />
        </geometry>
      </collision>
    </link>
    <gazebo reference="${prefix}link_5">
      <material>Gazebo/White</material>
    </gazebo>

    <!-- Flange Link -->
    <link name="${prefix}flange_link">
      <!-- <inertial>
        <origin xyz="0 0 0.025" rpy="0 0 0" />
        <mass value="0.1" />
        <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001" />
      </inertial>
      <visual>
        <origin xyz="0 0 0.025" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.04" length="0.05" />
        </geometry>
        <material name="Cyan" />
      </visual>
      <collision>
        <origin xyz="0 0 0.025" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.04" length="0.05" />
        </geometry>
      </collision> -->
    </link>
    <gazebo reference="${prefix}flange_link">
      <material>Gazebo/Gray</material>
    </gazebo>

    <!-- Fixed tool0 link -->
    <link name="${prefix}tool0">
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <mass value="0.01" />
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001" />
      </inertial>
      <!-- Optional: small visual or collision geometry could be added here -->
    </link>
    <joint name="${prefix}tool0_fixed_joint" type="fixed">
      <parent link="${prefix}flange_link" />
      <child link="${prefix}tool0" />
    </joint>
  </xacro:macro>

</robot>